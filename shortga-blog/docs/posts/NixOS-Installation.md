---
title: NixOS 安装教程
keywords: NixOS,Linux
date: 2023-07-30 23:04:04
updated: 2023-07-30 23:04:04
tags:
  - Linux
  - NixOS
---

在当今快节奏的数字时代，操作系统是我们日常生活中不可或缺的一部分。虽然市面上有着各种各样的操作系统，但是像 NixOS 这样的发行版却是极具独特性和前瞻性的存在。NixOS 凭借其先进的技术和独特的设计风格，成为了越来越多技术爱好者的不二之选。

然而，安装 NixOS 仍然可能是一个具有挑战性的任务。因此，本文旨在为大家提供一份详细的 NixOS 安装教程，从基本的安装到高级配置，带领大家一步步深入 NixOS 的世界，探索它的神奇之处，并最终成为它的熟练使用者。

<!-- more -->

## 引言

NixOS作为一种使用Nix包管理器的Linux发行版是一种充满智慧的系统。它的设计哲学，赋予了它在Linux发行版的领域中独一无二的地位。相比传统的Linux发行版，NixOS具有声明式的配置管理、可复现的构建、原子升级和回滚等特点。

值得一提的是，Nix包管理器作为一个纯函数式的包管理系统，它是一个绝对完美的包管理器。它可以确保每个软件包都是独立、不可变、可复现、可追溯、可缓存、可共享、可部署和可回滚的。也就是说，Nix避免了那些依赖地狱、版本冲突、配置漂移等常见的问题，同时提供了强大的沙盒、垃圾回收、分布式构建等功能。而Nix的设计哲学则是以纯函数式编程为基础，这使得它不仅仅避免了代码状态的不可预测性，还可以实现代码状态的可预测性。这一点，传统Linux包管理器所无法企及。

NixOS则是将Nix包管理器应用到整个操作系统上，使得操作系统也具备了纯函数式的特性。在NixOS中，所有的系统配置都是通过一个声明式的文件（/etc/nixos/configuration.nix）来定义的，这个文件描述了系统中需要安装哪些软件包、服务、用户、硬件驱动等等。通过运行nixos-rebuild命令，NixOS会根据这个文件自动构建出一个新的系统版本，并且可以随时切换到任何一个历史版本。这样就实现了原子升级和回滚，以及可复现和可迁移的系统状态。这种可复现性是NixOS的核心价值之一，在软件开发、测试、部署等方面都具有非常重要的意义。

除此之外，NixOS还有很多其他的优点。比如，它可以在不同的系统之间共享包，这意味着您可以将一个应用程序打包在一个单独的Nix文件中，并将其从一个系统复制到另一个系统，而无需担心依赖性。 此外，NixOS还支持容器化和虚拟化，这使得它更加灵活和可扩展。 因此，NixOS几乎可以满足各种不同的需求。

此外，NixOS还有许多其他的一些有趣的特性和功能。它支持各种不同的文件系统，包括ext4、btrfs、zfs等等。它还支持各种不同的桌面环境，包括GNOME、KDE、XFCE等等，并且可以根据用户的个人喜好进行定制。NixOS还支持各种不同的编程语言和开发框架，包括Python、Ruby、Haskell等等，这使得它成为一个非常强大的开发和测试平台。

NixOS还提供了一些其他的特性，这些特性不仅可以显著提高系统的可扩展性、灵活性、效率和安全性，还能够提供更加完善的用户体验。

首先，NixOS的模块化设计是一个令人瞩目的亮点。通过导入其他模块，例如nixpkgs、home-manager、nixos-hardware等，用户可以轻松地扩展或修改系统配置，以满足个性化需求。这种模块化设计使得NixOS具有非常强大的可扩展性和灵活性，可以根据用户的需求来定制系统。例如，如果您需要在系统上安装新的软件包，只需简单地导入nixpkgs模块，即可在系统中安装所需的软件包。此外，NixOS还支持模块的继承和复用，这使得用户可以更加高效地使用和管理模块。

其次，NixOS的自动化生成器是一个真正的劳心者之福音。通过一些生成器来自动产生配置文件，例如硬件检测，这种自动化的特性大大提高了用户的效率和系统的稳定性。例如，用户只需简单地运行NixOS的硬件检测生成器，便可自动检测系统中的硬件并生成相应的配置文件。

第三，NixOS的虚拟化功能是一个真正的全能存在。通过一些工具如nixos-container、nixops、lorri等，用户可以轻松地创建和管理虚拟机或容器，这些工具的存在让用户可以轻松地部署和管理多个虚拟机或容器，从而提高了系统的可扩展性和可靠性。例如，通过nixos-container工具，用户可以轻松地创建和管理容器，从而将应用程序隔离开来，提高系统的安全性和可靠性。此外，NixOS还支持虚拟机和容器的快照、回滚、复制和迁移等功能，这些功能使得用户可以更加方便地管理虚拟化环境。

最后，NixOS的安全机制是一个真正的防线。包括但不限于沙盒、隔离、加密等机制，这些机制的存在使得NixOS在网络安全、数据保护等方面具有非常强的实用性和可靠性。例如，NixOS支持沙盒化应用程序，通过将应用程序隔离在一个受保护的环境中，可以有效地防止应用程序对系统和其他应用程序造成的影响。此外，NixOS还支持网络隔离、加密文件系统、SELinux等功能，这些功能使得NixOS成为一个非常安全和可靠的操作系统。

综上所述，NixOS以其卓越性能和杰出质量在操作系统领域中占据了重要地位。无论是在个人电脑、服务器还是嵌入式设备等领域，NixOS都具有非常广泛的适用性和应用价值。NixOS的模块化设计、自动化生成器、虚拟化功能和安全机制等特性，都为用户提供了更加强大、灵活、高效和安全的系统管理方式，使得用户能够更加轻松地管理系统、提高工作效率、保护数据安全。因此，对于那些希望拥有一个高效、可靠、安全的操作系统的用户来说，NixOS是一个非常值得考虑的选择。

## 第一步：获取NixOS ISO

### 下载NixOS ISO

获取NixOS ISO镜像文件的方法繁多，一种简单而高效的方法是从NixOS官方网站获取。NixOS提供了多种版本，包括不同架构的版本，如x86_64和aarch64，以及适用于Linux、Windows（WSL2）和Docker等不同运行环境的版本。此外，还提供了VirtualBox镜像文件和用于Amazon EC2部署的预生成AMI镜像文件。在下载之前，可以根据硬件配置和实际需求选择合适的版本和架构。

然而，由于网络限制或其他原因，可能会遇到下载速度缓慢的问题。可以考虑从[mirrorz](https://mirrorz.org/os/NixOS)获取NixOS ISO镜像文件。

### 验证NixOS ISO

下载完成后，为确保所获取的NixOS ISO文件的完整性，需进行一次验证，以避免由于下载过程中的错误或损坏导致的问题。为验证ISO的完整性，需比较下载的ISO文件的哈希值与官方提供的哈希值。在NixOS官网上的下载页面上，可找到与每个版本对应的哈希值。在此，笔者向大家介绍如何验证ISO文件完整性。可使用sha256sum工具来计算ISO文件的哈希值。在终端中运行以下命令：

```bash
echo "6285cc9161b02b093849f27c50bdea06a495bcb1d61881ba977bd11625972ad6  nixos-plasma5-23.05.2403.d57e8c535d4-x86_64-linux.iso" | sha256sum --check
```

其中"6285cc9161b02b093849f27c50bdea06a495bcb1d61881ba977bd11625972ad6"是官方提供ISO文件的哈希值，"nixos-plasma5-23.05.2403.d57e8c535d4-x86_64-linux.iso"是ISO文件的文件名，将计算出的哈希值与官方提供的哈希值进行比较，若一致，则说明ISO文件完整无误。

以上是获取NixOS ISO镜像文件的方法以及验证ISO文件完整性的步骤。在下载和验证ISO文件时，需注意选择合适的版本和架构，并确保哈希值一致，以保证安装过程的顺利进行。

## 第二步：制作安装介质
 
制作安装介质有多种不同的方式，选择何种方式取决于你使用的操作系统和硬件设备。一般而言，你可以使用光盘、U盘或者网络启动的方式来安装NixOS。接下来，将详细介绍使用光盘、U盘刻录的具体步骤，以确保你能在如丝般顺滑的安装过程中体验到极致的乐趣。

### 刻录光盘

使用光盘进行安装是一种比较常见的方式，同时也是比较古老的一种。如果你有一个可刻录的光盘和光驱，那么非常适合使用这种方式。首先，你需要获取并下载ISO文件，之后便可将ISO文件刻录到光盘上。随后，将光盘插入目标机器的光驱中，重启机器并从光盘启动即可。

刻录光盘的方法有很多，不同的操作系统和软件可能有不同的界面和操作。一般来说，你需要选择一个刻录软件，比如Nero、ImgBurn、Brasero等，然后选择刻录模式为“写入映像文件”或者“写入ISO文件”，选择下载的ISO文件作为源文件，选择空白的光盘作为目标设备，然后开始刻录。

在刻录完成后，你可以在目标机器上进行测试，以确保光盘能够正常启动。如果不能启动，可能是因为光盘质量不佳、刻录速度过快或者刻录软件设置不正确等原因造成的。此时，你可以尝试更换光盘或者调整刻录参数重新刻录，以确保安装过程的顺利进行。

### 刻录U盘

与光盘相比，使用U盘进行安装则是一种更为现代的方式。如果你有一个空闲的U盘，那么将下载的ISO文件写入到U盘上将会是非常适合的。同样的，你需要准备一个写入工具，并选择下载的ISO文件作为源文件，选择空闲的U盘作为目标设备，随后开始写入。
不同平台的写入工具有所不同：

- 多平台  
  
Ventoy 是一个功能丰富的开源工具，支持多种类型的操作系统，包括 Windows和Linux。Ventoy 提供了许多功能，例如 Linux 持久性支持、Windows 自动安装支持、Linux 自动安装支持、变量扩展支持、Windows/Linux 自动安装脚本、主分区支持 FAT32/exFAT/NTFS/UDF/XFS/Ext2(3)(4)、支持大于 4GB 的 ISO 文件、菜单别名、菜单提示消息支持、密码保护支持、Legacy 和 UEFI 的本地启动菜单样式等等。Ventoy 还支持多种架构，包括 x86 Legacy BIOS、IA32 UEFI、x86_64 UEFI、ARM64 UEFI 和 MIPS64EL UEFI，可以满足不同用户的需求。此外，Ventoy 还经过了严格测试，支持超过 1100 个 iso 文件和 Linux vDisk (vhd/vdi/raw...) 启动解决方案，并支持菜单在 ListView 和 TreeView 模式之间动态切换。 

USBImager 是一个非常简单易用的 GUI 应用程序，可以将压缩的磁盘映像写入 USB 驱动器并创建备份。USBImager 支持 Windows、MacOS 和 Linux 平台，使用时无需安装，只需解压存档即可使用，非常方便。它的界面非常简单，没有多余的东西，只有必要的功能，而且不依赖于其他软件。

balenaEtcher 是一款免费开源图像刻录器，支持 Windows、macOS 和 GNU/Linux。它可以帮助用户轻松快速地刻录 USB 和 SD 卡图像，而且非常易于使用。Etcher 给用户提供了一个直观的 3 步流程，不需要任何命令行，即可完成刻录过程。Etcher 还具有一些实用的功能，例如确认闪存已完成、默认隐藏系统驱动器以避免意外擦除整个硬盘驱动器等等。Etcher 建立在开源工具之上，包括 JS、HTML、node.js 和 Electron 等，始终是免费和开源使用的，可以满足不同用户的需求。

- Windows
  
Rufus是一款值得称道的软件，它的功能丰富，操作简便，可以帮助用户快速创建可引导的USB启动盘，让其能够在几分钟内完成新的操作系统的安装。此款软件的用途十分广泛，它不仅支持Windows、Linux、UEFI等操作系统的ISO文件创建USB安装媒体，还可以在没有安装操作系统的系统上工作，刷新BIOS或其他固件，以及运行低级实用程序等。此外，Rufus还提供了许多其他功能，例如支持多种语言、操作系统、文件格式、启动模式和分区方案等。其简单易用的界面和高效的功能使得用户能够在短时间内完成启动盘的创建。 

- Linux
  
[Impression](https://gitlab.com/adhami3310/Impression)是一个具有现代感的简约应用程序，其独特的功能和创新的设计使其成为创建可启动驱动器的理想工具。通过Impression，您可以轻松地将磁盘映像刷入您的驱动器，从而在您的电脑中创建一个全新的引导系统。Impression的出色性能和卓越的功能使其成为狂热的发行版跳跃者和普通计算机用户的必备工具。Impression的优越性不仅体现在其简单易用的操作界面上，还彰显在其卓越的技术实现中。Impression采用最先进的数据转换技术，将磁盘映像转换为可启动的驱动器，确保了映像的完整性和准确性。除了其出色的功能和技术实现，Impression还具有极高的可靠性和稳定性。它的源代码经过了严格的测试和验证，确保了其高效的性能和稳定的运行。在[Flathub](https://flathub.org/apps/io.gitlab.adhami3310.Impression)上，您可以找到更多关于Impression的信息和使用技巧。

![Impression](/images/Impression.png)

在写入完成后，你可以在目标机器上进行测试，以确保U盘能够正常启动。如果不能启动，可能是因为U盘格式不支持或者写入软件设置不正确等原因造成的。这时，你可以尝试格式化U盘或者调整写入参数重新写入，以确保你的安装过程无懈可击。

综上所述，为了确保安装过程的顺利进行，你还需要确保所使用的介质质量良好，不出现损坏或错误等情况。在实践过程中，不妨多加留意，以确保你的安装过程流畅无阻，愉悦难忘。

## 第三步：设置网络

在NixOS的安装过程中，网络连接是一个至关重要的因素，因为它需要下载大量的软件包，这对于安装系统和后续的使用都具有非常重要的意义。因此，在进行安装之前，请务必确保您的电脑已经成功连接到互联网。此外，为了确保网络连接的稳定性，您可以使用以下方法优化您的网络设置，以便在安装过程中更加顺畅地进行操作。

如果您所处的网络环境不够理想，那么使用局域网网络代理就是您的不二之选。请放心，这并不是一个非常复杂的操作。您只需要使用`export all_proxy`命令即可完成。例如，如果您的代理服务器地址是`http://127.0.0.1:7890`，那么只需使用`export all_proxy=http://127.0.0.1:7890`命令即可设置代理。当然，代理服务器的地址和端口号会因不同的网络环境而有所不同。请您根据您的实际环境进行设置。

如果您需要更加详细的网络代理设置，那么proxychains工具将会是您的得力助手。它可以帮助您配置一些自定义的代理设置，以便您更好地适应各种网络环境。使用proxychains工具，您可以轻松地通过简单的命令行操作，进行代理的配置和使用。同时，它还提供了多种代理类型的支持，例如SOCKS4、SOCKS5、HTTP等。这使得您可以根据不同的网络环境，选择不同的代理类型，以获得更好的网络连接效果。

此外，通过使用proxychains工具，您还可以实现网络流量的分流和转发。这意味着您可以将某些特定的网络请求，通过代理服务器进行转发，以便更好地控制您的网络流量和数据传输。这种方式可以帮助您更好地保护您的网络安全和隐私，并避免某些不必要的网络风险和威胁。

总之，在进行NixOS安装之前，请务必确保您已经成功连接到互联网，并根据需要进行适当的网络设置。通过上述的网络设置方法和高级网络设置示例，相信您已经掌握了更加灵活和高效的网络连接方式，并且能够在NixOS的使用中更加得心应手。

## 第四步：分区

在我们即将开始探讨NixOS的安装之前，我恳请您耐心聆听我对于分区的至关重要性的详尽叙述。分区在计算机存储管理的伟大舞台上扮演着无可替代的关键角色，其将硬盘这一宏大的存储峰顶分成了若干个山峦，确保每个山峦都能独立而又协调地进行管理和利用。这一步骤的重要性不容小觑，因为它能够让您以更为出色的方式管理和保护您的珍贵数据。

对于那些对于Linux而言信手拈来的用户们，分区是操作系统安装过程中一项极为迫切的工序。在此，我愉快地将四种不同的分区工具呈现于你的眼前，它们分别是那沉静的fdisk、那娴熟的cfdisk、那聪慧的parted以及那玲珑的gparted。这些工具各自擅长进行基础分区操作，然而它们的使用方式却各有千秋。因此，在您着手安装NixOS之际，我切切地建议您先行学习这些工具的使用要领，以便在您的硬盘事务中游刃有余。

对于那些对于Btrfs文件系统充满渴望的用户而言，我特别推荐您参考Wiki上那一份关于[Btrfs](https://nixos.wiki/wiki/Btrfs)的令人艳羡的介绍。Btrfs作为一种现代化的文件系统，以其无限的魅力，包含了一连串的诱人特性，如奇妙的快照、可靠的数据校验以及灵动的动态分区。这种崭新的文件系统不仅赋予您更强大而又灵活的数据管理能力，更能如一把坚盾，守护您的数据免受突如其来的破坏。在这个极富启迪性的教程中，您将有幸领略如何借助Btrfs进行分区和子卷设置的奥妙，以助您深切领悟和充分运用Btrfs的精髓。

以上是我们为您准备的一部分分区操作介绍，希望在您学习这些操作的过程中，您能深刻领悟分区的重要性，并在未来的数据管理中游刃有余。

## 第五步：生成初始配置

在完成NixOS分区的工作后，您需要将分区挂载到/mnt目录下并生成初始配置文件。这个过程是非常重要的，因为它将直接影响您的系统的运行和配置。为了实现这个过程，我们可以轻松地使用`nixos-generate-config --root /mnt`命令，它会在/mnt/etc/nixos目录下生成两个文件，分别是`hardware-configuration.nix`和`configuration.nix`。

在这两个文件中，`hardware-configuration.nix`文件是由系统自动生成的，其中包含了一些与硬件相关的配置，例如分区、文件系统、内核模块等。这个文件是系统自动创建的，一般来说，您不需要对这个文件进行任何修改，因为它已经被NixOS默认配置好了。

而对于`configuration.nix`文件，它是NixOS的主要配置文件，它定义了您的系统如何运行。这个文件是非常重要的，因为它涵盖了NixOS的所有配置和管理选项，通过深入研究和理解这个文件，您可以更好地掌握NixOS的配置和管理技巧。在这个文件中，您可以设置很多选项，例如时区、语言、用户、密码等。

对于时区的设置，您可以使用NixOS的配置文件来实现，代码如下：

```Nix
time = {
  timeZone = "Asia/Shanghai";
  hardwareClockInLocalTime = true; # 使用本地时间作为硬件时间，像Windows那样
};
```

对于中文语言的设置，代码如下：

```Nix
i18n = {
  defaultLocale = "zh_CN.UTF-8"; 
  supportedLocales = [ "zh_CN.UTF-8/UTF-8" "en_US.UTF-8/UTF-8" ];
};
```

而对于用户和密码的设置，您可以通过NixOS的配置文件来添加用户和设置密码，代码如下：

```Nix
users.users.<用户名> = {
  isNormalUser = true;
  initialPassword = "<密码>";
};
```

对于zsh设置，代码如下：

```Nix
programs = {
  zsh = {
    enable = true;
    enableCompletion = true;
    autosuggestions = {
      enable = true;
      strategy = [ "history" ]; 
    };
  };
};
```

对于启动设置，代码如下：

```Nix
boot = {
  kernelPackages = pkgs.linuxPackages_lqx; # 使用Liquorix Kernel
  loader = {
    grub = {
      enable = true;
      device = "/dev/nvme0n1";
      configurationLimit = lib.mkDefault 5; # 限制启动列表数目
    };
    efi = {
      canTouchEfiVariables = true;
      efiSysMountPoint = "/boot/efi";
    };
  };
  initrd.kernelModules = [ "btrfs" ];
  kernelModules = [
    "fuse"
    "v4l2loopback"
  ];
  extraModulePackages = [
    pkgs.linuxKernel.packages.linux_lqx.v4l2loopback # 虚拟摄像头支持
  ];
  extraModprobeConfig = ''
    options v4l2loopback exclusive_caps=1 video_nr=9 card_label="obs"
  '';
};
```

需要注意的是，这些代码片段只是示例，您需要根据自己的具体情况进行修改和设置。

在NixOS的配置文件中，您可以设置很多不同的选项，例如：

- `boot.loader.grub.timeout`：设置GRUB启动菜单的超时时间。
- `networking.hostName`：设置主机名。
- `services.xserver.enable`：启用X Window System服务。

通过这些选项，您可以更好地掌握NixOS的配置和管理技巧。

## 第六步：安装

接下来，我们需要了解nixos-install --flake命令的作用和语法。这个命令可以根据我们的configuration.nix文件自动下载和安装所需的软件包，并安装引导程序。这个过程可能需要一些时间，因为NixOS需要从网络上下载大量的软件包。但是，这个过程的好处是，它可以自动从网络上下载所需的软件并进行安装，这对于使用者来说非常方便和省时。如果您想深入了解nixos-install命令的工作原理，可以使用--show-trace选项来查看它的运行过程。这意味着您可以对该命令的每一个细节都进行详尽的了解和研究，以确保您能够对NixOS系统有更深入的认识和理解。

最后，我们需要注意一些实用的技巧和注意事项。例如，在安装过程中，我们需要保持耐心和专注，不断地尝试和实践，以便更好地掌握和运用它。如果在安装过程中出现了问题，我们可以使用“nixos-rebuild switch --rollback”命令来回滚到之前的系统状态，以便更好地排除问题。此外，我们还可以使用“nix-shell”命令来创建一个沙箱环境，以便更好地测试和运行我们的代码。

总之，在探索NixOS的过程中，我们需要保持耐心和专注，不断地尝试和实践，以便更好地掌握和运用它。因为只有这样，我们才能真正地发掘出NixOS所具有的强大潜能和价值。无论是在软件开发还是系统管理方面，NixOS都是一个非常有用且强大的工具，因此我们需要更加深入地了解它，以便在我们的职业生涯中更好地运用它。

## 第七步：重启

在安装NixOS完成后，紧接着进行的重启过程是至关重要的一步。在拔出安装介质后，您需要重启电脑以便让新的操作系统生效。通过这一步骤，您可以立即开始体验NixOS带来的卓越表现，并且享受到其出色的性能、稳定性和安全性等特点。

值得一提的是，重启过程并不是一成不变的。根据您的个人需求，您可以选择不同的重启方式，以达到最佳的使用效果。例如，如果您希望管理系统资源更加高效，那么您可以使用命令行工具进行重启。

当然，在重启过程中，您需要注意保护您的个人数据和隐私，以免受到不必要的损失。因此，我们建议您在重启前备份重要的文件，以便在意外发生时能够迅速恢复数据。此外，您还可以使用加密技术对数据进行保护，以确保您的个人信息得到最大限度的安全保护，提高您的数据安全性。

总之，重启是NixOS使用过程中不可或缺的一步。通过选择适合自己的重启方式，您可以更好地管理您的电脑系统，更好地享受NixOS带来的卓越表现。